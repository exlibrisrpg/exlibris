<% content_for(:title) do %><%= t(".title") %><% end %>

<% content_for :banner do %>
  <div class="tw-bg-secondary-3 tw-text-secondary-12" data-controller="combobox" data-action="combobox-commit->combobox#add" data-combobox-hidden-class="hidden">
    <div class="container | centre tw-flex tw-flex-col tw-gap-8 | align-center tw-p-8">
      <h1 class="tw-font-display tw-text-6xl"><%= t(".title") %></h1>

      <%= render partial: "form", locals: { search: @search } %>
    </div>
  </div>
<% end %>

<% if @search.valid? %>
  <div class="tw-flex tw-flex-col tw-gap-8">
  <h2 class="tw-font-display tw-text-6xl align-center"><%= pluralize(@search.tags.count, Tag.model_name.human) %></h2>

  <div class="tw-flex tw-gap-4 tw-justify-center tw-font-body" data-controller="search-highlights">
    <% @search.tags.each do |tag| %>
      <%= link_to search_highlight(tag.name, @search.query&.split(" ")), tag %>
    <% end %>
  </div>

  <h2 class="tw-font-display tw-text-6xl align-center"><%= pluralize(@search.entries.count, Entry.model_name.human) %></h2>

  <%= render "shared/paginate", page: @page, path: ->(next_page) {search_path(query: @search.query, page: @page.next_param)}, class: "tw-flex tw-flex-col tw-gap-8" do %>
    <% @page.records.each do |entry| %>
      <div id="<%= dom_id entry %>" class="with-sidebar | tw-font-body" data-controller="search-highlights">
        <div>
          <div style="width: max(25%, 16rem)">
            <% if entry.cover.attached? %>
              <div class="tile" style="--cover-image: url('<%= url_for entry.cover %>');">
                <div class="tile--cover"></div>
              </div>
            <% end %>
          </div>

          <div class="tw-flex tw-flex-col tw-gap-3">
            <h1><%= link_to search_highlight(entry.name, @search.query&.split(" ")), entry %></h1>

            <% creator_tags = entry.tags.select(&:creator?) %>
            <% if creator_tags.any? %>
              <div class="tw-flex tw-gap-4">
                <%= render partial: "tags/tag", collection: creator_tags %>
              </div>
            <% end %>

            <div>
              <%= search_highlight entry.description.to_s, @search.query&.split(" ") %>
            </div>

            <% non_creator_tags = entry.tags.reject(&:creator?) %>
            <% if non_creator_tags.any? %>
              <div class="tw-flex tw-gap-4">
                <% non_creator_tags.group_by(&:tag_category).each_with_index do |(category, tags), index| %>
                  <% if index > 0 %><span>&mdash;</span><% end %>
                  <%= render partial: "tags/tag", collection: tags %>
                <% end %>
              </div>
            <% end %>

            <% if entry.links.any? %>
              <div class="tw-flex tw-gap-4">
                <% entry.links.each do |link| %>
                  <%= highlight_link_to link.address, class: "with-icon" do %>
                    <%= icon_tag link_icon(link) %>
                    <%= link_name(link) %>
                  <% end %>
                <% end %>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  <% end %>
  </div>
<% end %>
